<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MI-PRIME-CELL - Loja Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .product-card { transition: all 0.3s ease; }
        .product-card:hover { transform: translateY(-8px); }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <header class="bg-indigo-700 text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-6 flex flex-col md:flex-row justify-between items-center">
            <h1 class="text-3xl font-black tracking-tighter mb-4 md:mb-0">MI-PRIME-CELL</h1>
            <div class="relative w-full md:w-96">
                <input type="text" id="searchBar" onkeyup="applyFilters()" placeholder="Buscar iPhone (ex: 15 Pro Max)..." 
                       class="w-full px-4 py-2 rounded-lg text-gray-800 focus:ring-2 focus:ring-indigo-400 outline-none">
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 flex flex-col md:flex-row gap-8">
        
        <aside class="w-full md:w-64 space-y-8 bg-white p-6 rounded-xl shadow-sm h-fit">
            <div>
                <h2 class="text-lg font-bold mb-4 border-b pb-2">Marcas</h2>
                <div id="brand-filters" class="space-y-2"></div>
            </div>

            <div>
                <h2 class="text-lg font-bold mb-4 border-b pb-2">Pre√ßo M√°ximo</h2>
                <input type="range" id="priceRange" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                <div id="maxPriceDisplay" class="text-center font-bold text-indigo-600 mt-2">R$ 0,00</div>
            </div>

            <button onclick="clearFilters()" class="w-full py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm font-semibold transition">
                Limpar Filtros
            </button>
        </aside>

        <section class="flex-1">
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            
            <div id="no-products-message" class="hidden text-center py-20">
                <p class="text-gray-500 text-xl">Nenhum produto encontrado com esses filtros.</p>
            </div>
        </section>
    </main>

    <footer class="bg-white border-t mt-12 py-8 text-center text-gray-500 text-sm">
        <p>&copy; <span id="current-year"></span> MI-PRIME-CELL. Todos os direitos reservados.</p>
    </footer>

    <script type="text/javascript">
        let allProducts = [];
        
        // --- CONFIGURA√á√ÉO DA LOJA ---
        const WHATSAPP_LOJA = "5521999999999"; // <--- COLOQUE SEU NUMERO AQUI
        
        // --- CONFIGURA√á√ÉO SUPABASE ---
        const SUPABASE_URL = 'https://oixxpvupokedqfetyarz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9peHhwdnVwb2tlZHFmZXR5YXJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNDc0OTMsImV4cCI6MjA3ODgyMzQ5M30.rJthexTj2qtKPVQ2ogQrMHjFT-w0HmVlrq7JVMe6eQU';
        // -----------------------------

        document.getElementById('current-year').textContent = new Date().getFullYear();

        async function loadData() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/produtos?select=*`, {
                    headers: {
                        "apikey": SUPABASE_KEY,
                        "Authorization": `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const data = await response.json();
                
                allProducts = data.map((p, index) => ({
                    ...p,
                    id: p.id !== null ? p.id : index
                }));

                setupFilters(allProducts);
                applyFilters();

            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('products-grid').innerHTML = `
                    <div class="col-span-full p-8 bg-red-50 border border-red-200 rounded-xl text-center">
                        <p class="text-red-600 font-bold">Erro ao carregar produtos!</p>
                        <p class="text-red-500 text-sm">Verifique a conex√£o com o banco de dados.</p>
                    </div>
                `;
            }
        }

        function setupFilters(products) {
            const brands = [...new Set(products.map(p => p.marca))].sort();
            const container = document.getElementById('brand-filters');
            container.innerHTML = brands.map(brand => `
                <label class="flex items-center space-x-2 cursor-pointer group">
                    <input type="checkbox" name="brand" value="${brand}" onchange="applyFilters()" 
                           class="w-4 h-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <span class="text-gray-600 group-hover:text-indigo-600 transition">${brand}</span>
                </label>
            `).join('');

            const prices = products.map(p => p.preco || 0);
            const max = Math.max(...prices, 1000);
            const priceRange = document.getElementById('priceRange');
            priceRange.max = max;
            priceRange.value = max;
            updatePriceDisplay(max);
            priceRange.oninput = (e) => updatePriceDisplay(e.target.value);
        }

        function updatePriceDisplay(val) {
            document.getElementById('maxPriceDisplay').textContent = `R$ ${parseFloat(val).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchBar').value.toLowerCase();
            const maxPrice = parseFloat(document.getElementById('priceRange').value);
            const selectedBrands = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map(cb => cb.value);

            const filtered = allProducts.filter(p => {
                const matchSearch = (p.nome || "").toLowerCase().includes(searchTerm) || (p.descricao || "").toLowerCase().includes(searchTerm);
                const matchBrand = selectedBrands.length === 0 || selectedBrands.includes(p.marca);
                const matchPrice = (p.preco || 0) <= maxPrice;
                return matchSearch && matchBrand && matchPrice;
            });

            renderProducts(filtered);
        }

        function renderProducts(products) {
            const grid = document.getElementById('products-grid');
            const msg = document.getElementById('no-products-message');
            grid.innerHTML = '';
            
            if (products.length === 0) {
                msg.classList.remove('hidden');
                return;
            }
            msg.classList.add('hidden');

            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col h-full overflow-hidden';
                card.innerHTML = `
                    <div class="h-64 bg-gray-50 flex items-center justify-center p-6 relative">
                        <img src="${p.url_imagem}" class="max-h-full max-w-full object-contain" 
                             onerror="this.src='https://placehold.co/400x400?text=iPhone';">
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <span class="text-[10px] uppercase font-black text-indigo-500 mb-1">${p.marca}</span>
                        <h3 class="font-bold text-lg text-gray-900 leading-tight mb-2">${p.nome}</h3>
                        <p class="text-gray-500 text-xs line-clamp-3 italic flex-grow mb-4">"${p.descricao || ''}"</p>
                        
                        <div class="border-t pt-4">
                            <span class="text-gray-400 text-[10px] block uppercase font-bold">Valor √† vista</span>
                            <span class="text-2xl font-black text-indigo-700">R$ ${(p.preco || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                            
                            <button onclick="createWhatsappLink('${p.id}')" 
                                    class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2c-5.55 0-10 4.49-10 10.02 0 1.76.46 3.49 1.35 4.97l-1.39 5.09 5.22-1.37a9.9 9.9 0 004.82 1.28c5.55 0 10-4.47 10-10.02s-4.45-10.02-10-10.02zm5.4 14.54l-.45-.22c-.41-.2-.84-.31-1.3-.37l-.23-.03c-.26 0-.5.1-.69.28-.19.19-.48.42-.58.55-.1.13-.2.13-.37.05-.18-.08-1.12-.41-2.14-1.32-.8-.68-1.34-1.52-1.46-1.74-.11-.22-.0-.33.08-.41.08-.08.19-.18.28-.31.09-.12.12-.22.18-.33.06-.11.03-.21-.01-.4-.05-.19-.49-1.17-.67-1.55-.18-.38-.36-.31-.48-.31-.12 0-.28 0-.43.08-.16.08-.5.18-1.02.5-.52.32-1.03.77-1.25 1.02-.22.25-.45.62-.45 1.12s.18.96.25 1.02c.07.06.82 1.25 2.01 2.38 1.19 1.13 2.19 1.43 2.5 1.58.31.15.5.11.85.05.35-.06 1.12-.46 1.27-.92.15-.46.15-.84.11-.92-.04-.08-.16-.25-.33-.37z"/></svg>
                                RESERVAR AGORA
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function createWhatsappLink(id) {
            const p = allProducts.find(prod => prod.id == id);
            if (!p) return;
            const msg = `*INTERESSE EM COMPRA - MI-PRIME-CELL*\n\nOl√°! Gostaria de saber a disponibilidade do:\nüì± *${p.nome}*\nüí∞ Valor: R$ ${p.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}\n\nComo posso finalizar a reserva?`;
            window.open(`https://wa.me/${WHATSAPP_LOJA}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function clearFilters() {
            document.getElementById('searchBar').value = '';
            document.querySelectorAll('input[name="brand"]').forEach(c => c.checked = false);
            const range = document.getElementById('priceRange');
            range.value = range.max;
            updatePriceDisplay(range.max);
            applyFilters();
        }

        window.onload = loadData;
